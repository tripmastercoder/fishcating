<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Guessing Game - Dark Mode</title>
<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

<!-- Your CSS file -->
<link rel="stylesheet" href="style.css">



<style>
  /* Your existing sleek styling (same as before) */
  body {
    font-family: 'Inter', 'Segoe UI', sans-serif;
    background-color: #121212;
    color: #e0e0e0;
    margin: 0;
    padding: 0;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
  }
  h1 {
    font-size: 2rem;
    margin-top: 1rem;
    font-weight: 600;
    color: #ffffff;
  }
  #game {
    background-color: #1e1e1e;
    border-radius: 16px;
    padding: 2rem;
    margin: 0.5rem 0 4rem;
    max-width: 700px;
    width: 90%;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.7);
    text-align: center;
  }
  .question {
    font-size: 1.3rem;
    margin-bottom: 1.5rem;
    font-weight: 500;
    color: #bb86fc;
  }
  .answers {
  display: flex;
  flex-direction: column;
  align-items: center;
  white-space: pre-line;
  margin-top: 30px;    /* increase space above answers */
  margin-bottom: 5px;  /* reduce space below answers */
}
  .answer {
  text-align: left;
  white-space: normal;
  font-size: 0.9rem;          /* smaller font */
  font-family: monospace;
  letter-spacing: 0.2rem;  
  word-spacing: 0.1rem;   /* space out underscores */
  color: #cfcccc;
  margin: 0.5rem 0;
  user-select: none;
}

.answer span {
  /* border-bottom: 3px solid #555; */ /* removed underline */
  padding: 0 4px 0 4px;        /* adjust horizontal spacing */
  display: inline-block;
  min-width: 1ch;              /* narrow width for underscore */
  text-transform: uppercase;
}

.answer span.space {
  /* no underline anyway */
  padding: 0 0.6rem;          /* a bit wider space for spaces */
  min-width: 0.8rem;
}
  input[type="text"] {
    padding: 10px 12px;
    font-size: 1rem;
    border-radius: 8px;
    border: none;
    width: 80%;
    max-width: 350px;
    margin-bottom: 1rem;
    background-color: #2c2c2c;
    color: #eee;
    box-shadow: inset 0 0 5px #000;
    transition: background-color 0.3s ease;
  }
  input[type="text"]::placeholder {
    color: #777;
  }
  input[type="text"]:focus {
    outline: none;
    background-color: #3d3d3d;
    box-shadow: 0 0 5px #bb86fc;
  }
  button {
    background: linear-gradient(135deg, #8a2be2, #5d3fd3);
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: 12px;
    cursor: pointer;
    font-size: 1rem;
    font-weight: 500;
    margin: 0 5px 10px 5px;
    transition: all 0.2s ease-in-out;
    box-shadow: 0 4px 12px rgba(138, 43, 226, 0.6);
  }
  button:hover {
    background: linear-gradient(135deg, #5d3fd3, #8a2be2);
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(138, 43, 226, 0.8);
  }
  button:active {
    transform: translateY(0);
    box-shadow: none;
  }
  button.next-btn {
    background: linear-gradient(135deg, #03dac6, #018786);
    box-shadow: 0 4px 12px rgba(3, 218, 198, 0.6);
  }
  button.next-btn:hover {
    background: linear-gradient(135deg, #018786, #03dac6);
    box-shadow: 0 6px 16px rgba(3, 218, 198, 0.8);
  }
  #feedback {
    min-height: 1.5em;
    font-weight: 600;
    margin-bottom: 0.5rem;
  }
  .answers.multicolumn {
  font-size: 0.65rem; /* much smaller font */
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
  gap: 8px 12px;
  justify-items: start;
  align-items: center;
  max-height: 45vh;
  overflow-y: auto;
}

.answers.multicolumn .answer {
  white-space: normal;       /* Allow wrapping */
  letter-spacing: 0.1rem;    /* Reduce spacing */
  margin: 0.2rem 0;
  padding-right: 8px;        /* Some padding inside columns */
  word-break: break-word;    /* Break long words if needed */
  font-size: 0.75rem;        /* Slightly smaller to fit better */
}

</style>
</head>
<body>

<h1>Guessing Game</h1>
<div id="game">
  <div class="question" id="question"></div>
  <div class="answers" id="answers"></div>
  <input type="text" id="guess" placeholder="Enter your guess" autocomplete="off" />
  <div id="feedback"></div>
  <button id="submitBtn">Submit</button>
  <button id="nextBtn" class="next-btn">Next Question</button>
  <button id="revealBtn">Reveal Letter</button>

</div>

<script type="module">
  import { values, questions } from './data.js';

  // Normalize string: lowercase, trim, remove punctuation for fuzzy matching
  function normalize(str) {
    return str
      .toLowerCase()
      .replace(/[.,\/#!$%\^&\*;:{}=\-_`~()â€™â€˜'"]/g, "")
      .replace(/\s{2,}/g, " ")
      .trim();
  }

  function revealNextLetter() {
  // Loop through answers in order
  for (let i = 0; i < currentAnswers.length; i++) {
    const ans = currentAnswers[i];

    // If this answer is fully revealed, skip
    if (revealed[i]) continue;

    // Find first unrevealed character index
    const displayedDiv = document.getElementById("answers").children[i];
    const spans = displayedDiv.querySelectorAll("span");

    for (let j = 0; j < ans.length; j++) {
      if (ans[j] === " ") continue; // skip spaces

      if (spans[j].textContent === "_") {
        // Reveal this letter
        spans[j].textContent = ans[j].toUpperCase();

        // Check if this was the last letter in the answer
        let allRevealed = true;
        for (let k = 0; k < ans.length; k++) {
          if (ans[k] !== " " && spans[k].textContent === "_") {
            allRevealed = false;
            break;
          }
        }
        if (allRevealed) revealed[i] = true;

        return; // only reveal one letter per click
      }
    }
  }
} // <--- closes the function

  // Levenshtein distance for fuzzy matching
  function levenshtein(a, b) {
    const matrix = Array.from({ length: b.length + 1 }, (_, i) => [i]);
    for (let j = 0; j <= a.length; j++) matrix[0][j] = j;

    for (let i = 1; i <= b.length; i++) {
      for (let j = 1; j <= a.length; j++) {
        if (b.charAt(i - 1) === a.charAt(j - 1)) {
          matrix[i][j] = matrix[i - 1][j - 1];
        } else {
          matrix[i][j] = Math.min(
            matrix[i - 1][j - 1] + 1,
            matrix[i][j - 1] + 1,
            matrix[i - 1][j] + 1
          );
        }
      }
    }
    return matrix[b.length][a.length];
  }

  // Fuzzy match allowing 20% length difference
  function isCloseMatch(answer, guess) {
    const normAnswer = normalize(answer);
    const normGuess = normalize(guess);
    if (normAnswer === normGuess) return true;

    const dist = levenshtein(normAnswer, normGuess);
    const threshold = Math.max(1, Math.floor(normAnswer.length * 0.2));
    return dist <= threshold;
  }

  // Utility to pick random item
  function getRandomItem(arr) {
    return arr[Math.floor(Math.random() * arr.length)];
  }

  // State variables
  let currentIndex = 0;
  let currentAnswers = [];
  let revealed = [];
  let currentQuestionText = "";

  // Start question logic
  function startQuestion() {
    const q = questions[currentIndex];
    let xVal = "";

    if (q.categoryKey && typeof values[q.categoryKey] === "object" && !Array.isArray(values[q.categoryKey])) {
      // Pick random key in that category
      const keys = Object.keys(values[q.categoryKey]);
      xVal = getRandomItem(keys);
      currentAnswers = [...values[q.categoryKey][xVal]];
    } else {
      xVal = "";
      currentAnswers = Array.isArray(values[q.categoryKey]) ? [...values[q.categoryKey]] : [];
    }

    currentAnswers.sort();
    revealed = currentAnswers.map(() => false);
    currentQuestionText = q.template.replace("{X}", xVal);

    document.getElementById("question").textContent = `${currentQuestionText} (${currentAnswers.length} possible answers)`;
    document.getElementById("feedback").textContent = "";
    document.getElementById("guess").value = "";
    document.getElementById("revealBtn").addEventListener("click", revealNextLetter);
    renderAnswers();
  }

  // Render answers with underlined letters or underscores
  function renderAnswers() {
  const answersDiv = document.getElementById("answers");
  answersDiv.innerHTML = "";

  // If too many answers, use multicolumn style
  if (currentAnswers.length > 10) {
    answersDiv.classList.add("multicolumn");
  } else {
    answersDiv.classList.remove("multicolumn");
  }

  currentAnswers.forEach((ans, i) => {
    const displayText = revealed[i]
      ? ans.toUpperCase()
      : ans
          .split("")
          .map(ch => ch === " " ? " " : "_")
          .join("");

    const answerDiv = document.createElement("div");
    answerDiv.className = "answer";

    displayText.split("").forEach(ch => {
      const span = document.createElement("span");
      if (ch === " ") {
        span.classList.add("space");
        span.textContent = "\u00A0"; // non-breaking space
      } else {
        span.textContent = ch;
      }
      answerDiv.appendChild(span);
    });

    answersDiv.appendChild(answerDiv);
  });
}


  // Check player's guess
  function checkGuess() {
    const guessInput = document.getElementById("guess");
    const guess = guessInput.value.trim();
    const feedback = document.getElementById("feedback");

    if (!guess) {
      feedback.textContent = "Please enter a guess.";
      feedback.style.color = "#fbbf24";
      return;
    }

    let foundAny = false;
    currentAnswers.forEach((ans, i) => {
      if (!revealed[i] && isCloseMatch(ans, guess)) {
        revealed[i] = true;
        foundAny = true;
      }
    });

    if (foundAny) {
      feedback.textContent = "âœ… Correct guess!";
      feedback.style.color = "#4ade80";
      guessInput.value = "";
      renderAnswers();

      if (revealed.every(r => r)) {
        feedback.textContent = "ðŸŽ‰ All answers found!";
      }
    } else {
      feedback.textContent = "âŒ Incorrect guess, try again.";
      feedback.style.color = "#f87171";
    }
  }

  function nextCategory() {
  currentIndex++;
  if (currentIndex >= questions.length) {
    currentIndex = 0; // reset to first question
  }
  startQuestion();
}


  // Event listeners
  document.getElementById("submitBtn").addEventListener("click", checkGuess);
  document.getElementById("nextBtn").addEventListener("click", nextCategory);
  document.getElementById("guess").addEventListener("keydown", e => {
    if (e.key === "Enter") {
      e.preventDefault();
      checkGuess();
    }
  });

  // Initialize first question
  startQuestion();
</script>

</body>
</html>
